<div class="container">
  <div class="row valign-wrapper">
    <div class="col s8">      
      <h1><%= @campground.title %></h1>
    </div>
    <div class="col s4">
      <%= link_to "Back to all Campgrounds", campgrounds_path, class: "waves-effect waves-light btn" %>
    </div>
  </div>
  <div class="row">
    <div class="col s12">
      <%= image_tag @campground.campground_images.find_by(main_image: true).image.url, class: "materialboxed responsive-img" %>
    </div>
  </div>
  <div class="row">
    <% @campground.campground_images.where(main_image: nil).each do |campground_image| %>
      <div class="col s2">
        <%= image_tag campground_image.image.url, class: "materialboxed responsive-img" %>
      </div>
    <% end %>
  </div>
  <div class="row">
    <h5>By <%= @campground.user.full_name %></h5>
    <p><%= simple_format(@campground.content) %>
  </div>
  <div class="divider"></div>
  <div class="row valign-wrapper">
    <div class="col s8">
     <h3>Impressions</h3>
    </div>
    <% if !current_user.nil? %>
      <% if current_user.impressions.find_by(campground_id: @campground) %>
        <div class="col s4">
          <%= link_to "Edit your impression!", edit_impression_path(current_user.impressions.find_by(campground_id: @campground)), class: "waves-effect waves-light btn" %>
        </div>
      <% else %>
        <div class="col s4">
          <%= link_to "Provide your impression!", new_campground_impression_path(@campground), class: "waves-effect waves-light btn" %>
        </div>
      <% end %>
    <% end %>
  </div>
  <% @counts = @campground.count_impressions_totals %>
  <div class="row">
    <div class="col s4">
      <h5 class="col s12">Legend:</h5>
    </div>
    <div class="col s4">
      <div class="row">
        <h5 class="col s12">Clean?</h5>
      </div>
      <div class="row">
        <div class="ct-chart ct-golden-section col s12" id="chart1"></div>
      </div>
    </div>
    <div class="col s4">
      <div class="row">
        <h5 class="col s12">Crowded?</h5>
      </div>
      <div class="row">
        <div class="ct-chart ct-golden-section col s12" id="chart2"></div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col s4">
      <div class="row">
        <h5 class="col s12">Private?</h5>
      </div>
      <div class="row">
        <div class="ct-chart ct-golden-section col s12" id="chart3"></div>
      </div>
    </div>
    <div class="col s4">
      <div class="row">
        <h5 class="col s12">Shaded?</h5>
      </div>
      <div class="row">
        <div class="ct-chart ct-golden-section col s12" id="chart4"></div>
      </div>
    </div>
    <div class="col s4">
      <div class="row">
        <h5 class="col s12">Fire tolerant?</h5>
      </div>
      <div class="row">
        <div class="ct-chart ct-golden-section col s12" id="chart5"></div>
      </div>
    </div>
  </div>
  <div class="divider"></div>
  <div class="row">
    <h3 class="col s12">Comments</h3>
  </div>
  <% @campground.comments.each do |comment| %>
    <div class="divider"></div>
    <div class="row section">
      <div class="col s3">
        <div class="chip">
          <%= image_tag comment.user.image.url(:thumb), alt: "Contact Person" %>
          <%= comment.user.full_name %>
        </div>        
      </div>
      <div class="col s7">
        <p><%= simple_format(comment.content) %></p>
      </div>
      <% if current_user == comment.user %>
        <div class="col s1">
          <%= link_to edit_comment_path(comment), class: "btn-floating green" do %>
            <i class="material-icons">mode_edit</i>
          <% end %>
        </div>
        <div class="col s1">
          <%= link_to comment_path(comment), method: :delete, data: { confirm: "Are you sure you want to delete this comment?"}, class: "btn-floating red" do %>
            <i class="material-icons">delete</i>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
  <div class="row">
    <%= link_to "Add a comment", new_campground_comment_path(@campground) %>
  </div>
</div>

<% if current_user == @campground.user %>
  <div class="fixed-action-btn">
    <a class="btn-floating btn-large teal accent-4">
      <i class="large material-icons">menu</i>
    </a>
    <ul>
      <li>
        <%= link_to edit_campground_path, class: "btn-floating green" do %>
          <i class="material-icons">mode_edit</i>
        <% end %>
      </li>
      <li>
        <button data-target="delete-modal" class="modal-trigger btn-floating red darken-1"><i class="material-icons">delete</i></button>
      </li>
    </ul>
  </div>
  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <h4>Are you sure you want to delete this campground?</h4>
      <p>Clicking yes will permanently delete your campground.</p>
    </div>
    <div class="modal-footer">
      <button class="modal-action modal-close waves-effect waves-green btn-flat ">No</button>
      <%= link_to "Yes", campground_path(@campground), method: :delete, class: "modal-action modal-close waves-effect waves-red btn-flat" %>
    </div>
  </div>
<% end %>

<script>
  $(document).ready(function(){
    $('.materialboxed').materialbox();
  });

  $(document).ready(function(){
    $('.modal').modal();
  });

  var yesImpressions = <%= [@counts[:clean_yes], @counts[:crowded_yes], @counts[:privacy_yes], @counts[:shade_yes], @counts[:fire_yes]] %>;
  var noImpressions = <%= [@counts[:clean_no], @counts[:crowded_no], @counts[:privacy_no], @counts[:shade_no], @counts[:fire_no]] %>;
  var sums = [];
  function calculateImpressionsTotals () {
    for (var i = 0; i < yesImpressions.length; i++) {
      sums.push(2 * (yesImpressions[i] + noImpressions [i]));
    };
  }
  calculateImpressionsTotals();

  new Chartist.Pie('#chart1', {
    series: [yesImpressions[0], noImpressions[0]]
  }, {
    donut: true,
    donutWidth: 30,
    startAngle: 270,
    total: sums[0],
    showLabel: true
  });
  new Chartist.Pie('#chart2', {
    series: [yesImpressions[1], noImpressions[1]]
  }, {
    donut: true,
    donutWidth: 30,
    startAngle: 270,
    total: sums[1],
    showLabel: true
  });
  new Chartist.Pie('#chart3', {
    series: [yesImpressions[2], noImpressions[2]]
  }, {
    donut: true,
    donutWidth: 30,
    startAngle: 270,
    total: sums[2],
    showLabel: true
  });
  new Chartist.Pie('#chart4', {
    series: [yesImpressions[3], noImpressions[3]]
  }, {
    donut: true,
    donutWidth: 30,
    startAngle: 270,
    total: sums[3],
    showLabel: true
  });
  new Chartist.Pie('#chart5', {
    series: [yesImpressions[4], noImpressions[4]]
  }, {
    donut: true,
    donutWidth: 30,
    startAngle: 270,
    total: sums[4],
    showLabel: true
  });
</script>